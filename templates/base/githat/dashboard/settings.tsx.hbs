{{#if includeOrgManagement}}
'use client';

import { useState } from 'react';
import { useAuth } from '@githat/nextjs';
import { orgsApi } from '../api/orgs{{#unless typescript}}.js{{/unless}}';

export function DashboardSettings() {
  const { org } = useAuth();
  const [name, setName] = useState(org?.name || '');
  const [brandColor, setBrandColor] = useState(org?.brandColor || '#7c3aed');
  const [saving, setSaving] = useState(false);
  const [saved, setSaved] = useState(false);
  const [error, setError] = useState('');

  if (!org) {
    return <p style=\{{ color: '#71717a' }}>Select an organization to view settings.</p>;
  }

  const handleSave = async (e{{#if typescript}}: React.FormEvent{{/if}}) => {
    e.preventDefault();
    setSaving(true);
    setError('');
    setSaved(false);
    try {
      await orgsApi.update(org.id, { name, brandColor });
      setSaved(true);
    } catch {
      setError('Failed to save settings.');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div>
      <h1 style=\{{ fontSize: '1.5rem', fontWeight: 600, color: '#fafafa', marginBottom: '1.5rem' }}>Settings</h1>
      <form onSubmit={handleSave} style=\{{ maxWidth: '32rem', display: 'grid', gap: '1.5rem' }}>
        <div>
          <label style=\{{ fontSize: '0.875rem', color: '#71717a', display: 'block', marginBottom: '0.375rem' }}>Organization Name</label>
          <input
            value={name}
            onChange={(e) => setName(e.target.value)}
            style=\{{ width: '100%', padding: '0.625rem 0.75rem', background: '#111113', border: '1px solid #1e1e2e', borderRadius: '0.375rem', color: '#fafafa', outline: 'none' }}
          />
        </div>
        <SettingField label="Slug" value={org.slug} />
        <SettingField label="Tier" value={org.tier} />
        <div>
          <label style=\{{ fontSize: '0.875rem', color: '#71717a', display: 'block', marginBottom: '0.375rem' }}>Brand Color</label>
          <div style=\{{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
            <input
              type="color"
              value={brandColor}
              onChange={(e) => setBrandColor(e.target.value)}
              style=\{{ width: '2.5rem', height: '2.5rem', border: '1px solid #1e1e2e', borderRadius: '0.375rem', background: 'transparent', cursor: 'pointer' }}
            />
            <span style=\{{ color: '#a1a1aa', fontSize: '0.875rem', fontFamily: 'monospace' }}>{brandColor}</span>
          </div>
        </div>

        {error && <p style=\{{ color: '#ef4444', fontSize: '0.875rem' }}>{error}</p>}
        {saved && <p style=\{{ color: '#34d399', fontSize: '0.875rem' }}>Settings saved.</p>}

        <button
          type="submit"
          disabled={saving}
          style=\{{ padding: '0.625rem 1.25rem', background: '#7c3aed', color: '#fff', border: 'none', borderRadius: '0.375rem', fontWeight: 600, cursor: 'pointer', opacity: saving ? 0.6 : 1, justifySelf: 'start' }}
        >
          {saving ? 'Saving...' : 'Save changes'}
        </button>
      </form>
    </div>
  );
}

function SettingField({ label, value }{{#if typescript}}: { label: string; value: string }{{/if}}) {
  return (
    <div>
      <label style=\{{ fontSize: '0.875rem', color: '#71717a', display: 'block', marginBottom: '0.375rem' }}>{label}</label>
      <div style=\{{ padding: '0.625rem 0.75rem', background: '#111113', border: '1px solid #1e1e2e', borderRadius: '0.375rem', color: '#fafafa' }}>
        {value}
      </div>
    </div>
  );
}
{{/if}}
